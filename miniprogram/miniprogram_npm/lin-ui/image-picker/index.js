import validator from"../behaviors/validator";Component({externalClasses:["l-class","l-item-class"],behaviors:["wx://form-field",validator],properties:{urls:{type:Array,value:[]},count:{type:[String,Number],value:9},clear:{type:Boolean,value:!1,observer:function(e){e&&this.handleClear()}},size:{type:[String,Number],value:3,options:[3,4,"3","4"]},sizeType:{type:String,value:"original",options:["original","compressed"]},mode:{type:String,value:"aspectFit",options:["scaleToFill","aspectFit","aspectFill","widthFix","top","bottom","center","left","right","top left","top right","bottom left","bottom right"]},custom:{type:Boolean,value:!1},preview:{type:Boolean,value:!0},maxImageSize:{type:Number,value:1e7},cells:{type:Array,value:null}},data:{showBtn:!0,tempFilePath:""},lifetimes:{attached:function(){let e=this.judgeNewOrOld();null!==this.data.cells?(e="new",this.setData({newOrOld:e,urls:this.data.cells})):this.setData({newOrOld:e})}},methods:{handleClear(){let e=this.data.urls;this.setData({urls:[],clear:!1,showBtn:!0});let t={all:e,current:e};this.triggerEvent("linclear",t,{})},onPreviewTap(e){const t=e.currentTarget.dataset.index,l=this.data.urls;let a="",s=[];const i=this.data.newOrOld;if("[object Object]"===Object.prototype.toString.call(this.data.cells)){const e=this.data.cells;a=e[t].url;for(let t=0;t<e.length;t++)s.push(e[t].url)}else if("old"===i)a=this.data.urls[t],s=this.data.urls;else{a=this.data.urls[t].url;for(let e=0;e<l.length;e++)s.push(l[e].url)}let r={index:t,current:l[t],all:l};!0===this.data.preview&&wx.previewImage({current:a,urls:s}),this.triggerEvent("linpreview",r,{})},onAddTap(){const e=this,t=this.data.count-this.data.urls.length;if(0===t)return;const l=this.data.newOrOld;wx.chooseImage({count:t,sizeType:this.data.sizeType,sourceType:["album","camera"],success(t){let a=[];if("old"===l)a=t.tempFilePaths;else for(let l=0;l<t.tempFilePaths.length;l++)a.push({url:t.tempFilePaths[l],imageSize:t.tempFiles[l].size}),a[l].overSize=t.tempFiles[l].size>e.data.maxImageSize;const s=e.data.urls.concat(a);s.length===parseInt(e.data.count)&&e.setData({showBtn:!1}),e.setData({urls:s,value:s,tempFilePath:a});let i={current:a,all:s},r={};e.triggerEvent("linchange",i,r),e.triggerEvent("linpush",i,r);let n=[];for(let e=0;e<s.length;e++)s[e].overSize&&n.push(s[e]);if(n.length>0){let t={current:a,all:s,overSizeList:n};e.triggerEvent("linoversize",t,r)}}})},onDelTap(e){const t=e.currentTarget.dataset.index,l=this.data.urls,a=l[t],s=this.handleSplice(l,a);s.length<parseInt(this.data.count)&&this.setData({showBtn:!0}),this.setData({tempFilePath:a,urls:s,value:s});let i={index:t,current:a,all:s};this.triggerEvent("linremove",i,{})},handleSplice:(e,t)=>e.filter(e=>e!==t),judgeNewOrOld:function(){const e=this.data.urls;return 0!==e.length&&"object"!=typeof e[0]?"old":"new"}}});